IDENTIFICATION DIVISION.
PROGRAM-ID. ACCOUNTS-REPORT.
AUTHOR. BANK-SYSTEM.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT ACCOUNT-FILE ASSIGN TO "ACCOUNTS.DAT"
        ORGANIZATION IS LINE SEQUENTIAL.
    SELECT REPORT-FILE ASSIGN TO "REPORT.TXT"
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD ACCOUNT-FILE.
01 ACCOUNT-RECORD.
   05 ACCNO              PIC X(3).
   05 ACCNAME            PIC X(25).
   05 TRANS-TYPE         PIC X(1).
   05 AMOUNT             PIC 9(6)V99.

FD REPORT-FILE.
01 REPORT-LINE           PIC X(80).

WORKING-STORAGE SECTION.
01 WS-EOF                PIC X VALUE 'N'.
01 WS-DEPOSITOR-COUNT    PIC 9(5) VALUE 0.
01 WS-TOTAL-BALANCE      PIC 9(9)V99 VALUE 0.

01 WS-DETAIL-LINE.
   05 WS-DET-ACCNO       PIC X(3).
   05 FILLER             PIC X(5) VALUE SPACES.
   05 WS-DET-NAME        PIC X(25).
   05 FILLER             PIC X(5) VALUE SPACES.
   05 WS-DET-TYPE        PIC X(1).
   05 FILLER             PIC X(5) VALUE SPACES.
   05 WS-DET-AMOUNT      PIC ZZZ,ZZ9.99.
   05 FILLER             PIC X(26) VALUE SPACES.

01 WS-TOTAL-LINE1.
   05 FILLER             PIC X(5) VALUE SPACES.
   05 FILLER             PIC X(17) VALUE 'TOTAL DEPOSITORS:'.
   05 FILLER             PIC X(5) VALUE SPACES.
   05 WS-TOT-DEPOSITORS  PIC ZZ,ZZ9.
   05 FILLER             PIC X(47) VALUE SPACES.

01 WS-TOTAL-LINE2.
   05 FILLER             PIC X(5) VALUE SPACES.
   05 FILLER             PIC X(28) 
      VALUE 'TOTAL ACCUMULATED BALANCES:'.
   05 FILLER             PIC X(2) VALUE SPACES.
   05 WS-TOT-BALANCE     PIC ZZ,ZZZ,ZZ9.99.
   05 FILLER             PIC X(33) VALUE SPACES.

01 WS-BLANK-LINE         PIC X(80) VALUE SPACES.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    OPEN INPUT ACCOUNT-FILE
    OPEN OUTPUT REPORT-FILE
    
    PERFORM READ-ACCOUNT
    PERFORM PROCESS-RECORDS UNTIL WS-EOF = 'Y'
    PERFORM PRINT-TOTALS
    
    CLOSE ACCOUNT-FILE
    CLOSE REPORT-FILE
    STOP RUN.

READ-ACCOUNT.
    READ ACCOUNT-FILE
        AT END MOVE 'Y' TO WS-EOF
    END-READ.

PROCESS-RECORDS.
    MOVE ACCNO TO WS-DET-ACCNO
    MOVE ACCNAME TO WS-DET-NAME
    MOVE TRANS-TYPE TO WS-DET-TYPE
    MOVE AMOUNT TO WS-DET-AMOUNT
    
    WRITE REPORT-LINE FROM WS-DETAIL-LINE
    
    ADD 1 TO WS-DEPOSITOR-COUNT
    
    IF TRANS-TYPE = 'D'
        ADD AMOUNT TO WS-TOTAL-BALANCE
    ELSE
        IF TRANS-TYPE = 'W'
            SUBTRACT AMOUNT FROM WS-TOTAL-BALANCE
        END-IF
    END-IF
    
    PERFORM READ-ACCOUNT.

PRINT-TOTALS.
    WRITE REPORT-LINE FROM WS-BLANK-LINE
    MOVE WS-DEPOSITOR-COUNT TO WS-TOT-DEPOSITORS
    WRITE REPORT-LINE FROM WS-TOTAL-LINE1
    MOVE WS-TOTAL-BALANCE TO WS-TOT-BALANCE
    WRITE REPORT-LINE FROM WS-TOTAL-LINE2.
    